#!/usr/bin/env perl

my $filename = shift;

open(IN,"<$filename");
print "/* this file belongs to luatex, and is auto-generated by the makecpool script */

\#include <stdio.h>
\#include \"luatexdir/ptexlib.h\"

static char *poolfilearr[] = {\n";
while (<IN>) {
  chomp;
  my $data = $_;
  last if /^\*/;
  $data =~ s/^\d\d//;
  $data =~ s/(["\\])/\\$1/g;
  print "  \"$data\",\n";
}
close IN;
print '  NULL };

int 
loadpoolstrings (integer spare_size) {
  strnumber g;
  int i,j,l;
  char *s;
  g = 0;
  i = 0;
  j = 0;
  while (s = poolfilearr[j++]) {
    l = strlen (s);
	i += l;
	if (i>=spare_size)
	  return 0;
    while (l-- > 0)
        strpool[poolptr++] = *s++;
    g = makestring ();
  }
  return g;
}
';
